import{s as r,c as p}from"./constellation-uI2meXO3.js";import{l as b}from"./adminAudit-BQKTmVXV.js";const h=document.getElementById("login-form"),x=document.getElementById("email"),w=document.getElementById("password"),s=document.getElementById("submit-button"),n=s.querySelector("span"),l=document.getElementById("status");function t(i,o=!1){l.textContent=i,o?l.className="mt-4 rounded-xl border border-red-500/50 bg-red-500/10 p-3 text-sm text-red-200":l.className="mt-4 rounded-xl border border-slate-800 bg-slate-950/50 p-3 text-sm text-slate-400"}h.addEventListener("submit",async i=>{i.preventDefault(),s.disabled=!0;const o=n.textContent;n.textContent="Verifying...",t("Connecting to secure services...");const a=x.value.trim(),u=w.value;try{const{data:e,error:c}=await r.auth.signInWithPassword({email:a,password:u});if(c){t(c.message,!0),s.disabled=!1,n.textContent=o;return}t("Authentication successful! Checking profile...");const{data:m,error:g}=await r.from("profiles").select("role").eq("id",e.user.id).single();if(g||!m){console.log("Profile not found, creating one for first-time login...");const{error:d}=await r.from("profiles").insert([{id:e.user.id,email:e.user.email,role:"administrator",status:"active"}]);d&&console.error("Error creating profile:",d)}t("Authentication successful! Logging event..."),await b({client:r,action:"login",tableName:"auth",summary:`User ${e?.user?.email||a} signed in`,recordId:e?.user?.id||null,actor:e?.user?.email||a}),t("Redirecting to dashboard...");const f=window.location.hostname.includes("github.io")?"/TechlocSave":"";window.location.replace(f+"/index.html")}catch(e){console.error("Auth error:",e),t("An unexpected error occurred. Please check your connection.",!0),s.disabled=!1,n.textContent=o}});document.addEventListener("DOMContentLoaded",()=>{p()});

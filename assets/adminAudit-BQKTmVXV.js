import{s as _}from"./constellation-uI2meXO3.js";const g="admin_change_log",p=5*60*1e3;let o={value:null,expiresAt:0};const u=()=>Date.now(),i=n=>n===void 0||n===null?null:typeof n=="object"?JSON.stringify(n):n,y=async(n,t)=>{if(t)return t;if(o.value&&o.expiresAt>u())return o.value;try{const{data:e}=await n.auth.getUser(),r=e?.user?.email||e?.user?.id||"anon";return o={value:r,expiresAt:u()+p},r}catch(e){return console.warn("Admin audit: unable to resolve actor",e?.message||e),"anon"}},h=async({client:n,action:t="edit",tableName:e="admin",summary:r="",recordId:c=null,columnName:d=null,previousValue:m=null,newValue:f=null,actor:w=null}={})=>{const l=n||_||(typeof window<"u"?window.supabaseClient:null);if(!l)return!1;try{const a=await y(l,w),s=String(t||"edit").toLowerCase(),A=`Admin ${s} on ${e}`;return await l.from(g).insert([{table_name:e,action:s,summary:r||A,actor:a||"anon",record_id:c??null,column_name:d??null,previous_value:i(m),new_value:i(f),created_at:new Date().toISOString()}]),!0}catch(a){return console.warn("Admin audit: unable to write change log entry",a?.message||a),!1}};export{h as l};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/constellation-uI2meXO3.js","assets/constellation-BFegDoL-.css"])))=>i.map(i=>d[i]);
import{c as Ve,_ as ze}from"./constellation-uI2meXO3.js";import{r as _e}from"./Header-CYr_2qJu.js";_e("header-root");Ve();const je=(e,l="")=>{const n=lucide?.icons?.[e];if(!n)return null;const a=n.toSvg({class:l,"data-lucide":e,"data-lucide-initialized":"true"}),s=document.createElement("span");return s.innerHTML=a,s.firstElementChild},ke=(e=document)=>{if(!lucide?.icons)return;const l=[];e.matches?.("[data-lucide]")&&l.push(e),e.querySelectorAll?.("[data-lucide]").forEach(n=>l.push(n)),l.forEach(n=>{if(n.getAttribute("data-lucide-initialized")==="true")return;const a=n.getAttribute("data-lucide"),s=n.getAttribute("class")||"",i=je(a,s);i&&n.replaceWith(i)})},be=(e,l)=>{e&&(e.setAttribute("data-lucide",l),e.removeAttribute("data-lucide-initialized"),ke(e))};ke();const se="rounded-xl border border-slate-700 bg-slate-950/60 px-2 py-1 text-[10px] hover:bg-slate-900/60",qe="https://ewgtclzscwbokxmzxbcu.supabase.co",Ue="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV3Z3RjbHpzY3dib2t4bXp4YmN1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUwODA3MzIsImV4cCI6MjA4MDY1NjczMn0.QkM72rVeBpm6uGgBVdG4ulIzEg3V_7T8usqvIf6vBto",Se=(e,l,n)=>{const a=document.getElementById("debug-banner"),s=document.getElementById("debug-text"),i=document.getElementById("debug-pre");a.classList.remove("hidden"),s.textContent=`${e} — ${l||""}`.trim(),i.textContent=n?JSON.stringify(n,null,2):"",document.getElementById("debug-copy").onclick=async()=>{const u=`${e}
${l||""}

${i.textContent}`.trim();try{await navigator.clipboard.writeText(u)}catch{}}},_=e=>{const l=document.getElementById("connection-status"),n=document.getElementById("connection-dot");l.textContent=e,n.className="h-2.5 w-2.5 rounded-full",e==="Live"?n.classList.add("bg-emerald-400","shadow-[0_0_10px_rgba(52,211,153,0.8)]"):e.includes("Reconnect")?n.classList.add("bg-amber-400","shadow-[0_0_10px_rgba(251,191,36,0.8)]"):n.classList.add("bg-slate-500")};let F=null;const Ye=async()=>{try{const e=await ze(()=>import("./constellation-uI2meXO3.js").then(l=>l.b),__vite__mapDeps([0,1]));if(F=e.supabase||e.default||null,F?.from)return F;throw new Error("supabaseClient.js loaded but did not export a Supabase client (expected export const supabase = createClient(...)).")}catch{return F=window.supabase.createClient(qe,Ue),F}},t={filters:{dateRange:{start:"",end:""},dateKey:"",salesChannels:["Finance-EX"],salesChannelKey:"",lastLeadKey:"",lastLeadSelection:!0,lastLeadFilterActive:!1,categoryFilters:{},columnFilters:{},chartFilters:{},unitTypeKey:"",unitTypeSelection:[],vehicleStatusKey:"",vehicleStatusSelection:[]},vehiclesRaw:new Map,schema:[],table:{page:1,perPage:8,sort:{key:"",direction:"asc"},columns:{},columnOrder:[],columnWidths:{},columnLabels:{}},derived:{filtered:[],kpis:{active:0,hold:0},statusBars:[]},chartSegments:{},chartVisibility:{},chartVisibilityOptions:{},realtime:{channel:null},layout:{alertsPanelWidth:null,chartSplitWidth:null,dealPanelHeight:null,fullChartHeight:null,fullChartCollapsed:!1},preferences:{userId:null,config:null,saveTimer:null},ui:{isLoading:!0}},Xe=["from-emerald-400 to-green-500","from-blue-400 to-indigo-500","from-amber-400 to-orange-500","from-rose-400 to-red-500","from-teal-400 to-cyan-500","from-slate-400 to-slate-500"],Je=["from-fuchsia-400 to-purple-500","from-cyan-400 to-sky-500","from-lime-400 to-emerald-500","from-orange-400 to-amber-500","from-pink-400 to-rose-500","from-violet-400 to-indigo-500"],Y="dealStatus",Ie="inventoryControlTableColumns",Ae="inventoryControlPreferences",Be="user_table_configs",Te="Inventory Control",oe=e=>{if(!e)return"--";const l=new Date(e);return Number.isNaN(l.getTime())?"--":l.toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"2-digit"})},G=e=>new Intl.NumberFormat("en-US").format(e),Ge=new Set(["mileage"]),ve=new Set(["price on contract","scheduled amount","open balance","regular amount"]),Qe=e=>{if(e==null||e==="")return"--";const l=Number(String(e).replace(/,/g,""));return Number.isFinite(l)?G(l):e},Ze=e=>{if(e==null||e==="")return"--";const l=Number(String(e).replace(/[$,]/g,""));return Number.isFinite(l)?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(l):e},ee=e=>e.replace(/_/g," "),X=e=>t.table.columnLabels?.[e]||t.schema.find(l=>l.key===e)?.label||ee(e),et=()=>{t.schema.length&&(t.schema=t.schema.map(e=>({...e,label:t.table.columnLabels?.[e.key]||ee(e.key)})))},tt=(e,l)=>{const n=l?.trim()||"";(!t.table.columnLabels||typeof t.table.columnLabels!="object")&&(t.table.columnLabels={}),n?t.table.columnLabels[e]=n:delete t.table.columnLabels[e];const a=t.schema.find(s=>s.key===e);a&&(a.label=n||ee(e))},nt=e=>{let l=!1,n=!1,a=!1,s=!1;return e.forEach(i=>{if(!(i==null||i==="")){if(typeof i=="boolean"){a=!0;return}if(typeof i=="number"&&!Number.isNaN(i)){n=!0;return}if(i instanceof Date){s=!0;return}if(typeof i=="string"){const u=i.trim(),f=Date.parse(u);if(!Number.isNaN(f)&&/[-/T:]/.test(u)){s=!0;return}if(u&&!Number.isNaN(Number(u))){n=!0;return}l=!0;return}l=!0}}),l?"string":s&&!n&&!a?"date":n&&!a?"number":a&&!n?"boolean":s?"date":n?"number":a?"boolean":"string"},lt=new Set(["Deal Date","Calc. End","Inv. Prep. Stat. On","Oldest Invoice (Open)","Last Payment date","Last Ping"]),$e=e=>{if(!e?.length)return[];const l=e.slice(0,50);return Object.keys(e[0]).map(n=>{const a=l.map(i=>i?.[n]),s=t.table.columnLabels?.[n];return{key:n,label:s||ee(n),type:lt.has(n)?"date":nt(a)}})},at=(e,l)=>e.map(n=>n?.[l]).filter(n=>n!=null&&n!==""),te=(e,l)=>{const n=new Set;return e.forEach(a=>{const s=a?.[l];s!=null&&s!==""&&n.add(String(s))}),Array.from(n).sort((a,s)=>a.localeCompare(s))},st=e=>{const l=e.find(n=>n.type==="date"&&/created_at|created|updated_at|updated/i.test(n.key));return l?l.key:e.find(n=>n.type==="date")?.key||""},rt=e=>e.find(l=>/sales channel/i.test(l.key))?.key||"",it=e=>e.find(l=>/last\s*(lead|deal)/i.test(l.key)||/last\s*(lead|deal)/i.test(l.label))?.key||"",ot=e=>e.find(l=>/unit\s*type/i.test(l.key)||/unit\s*type/i.test(l.label))?.key||"",ct=e=>e.find(l=>l.key==="status")?.key||e.find(l=>/vehicle\s*status/i.test(l.key)||/vehicle\s*status/i.test(l.label))?.key||"",dt={"out for repo":"bg-gradient-to-r from-pink-500/20 via-pink-400/10 to-pink-500/20 backdrop-blur-sm","passtime unavailable":"bg-gradient-to-r from-amber-700/25 via-amber-500/10 to-amber-700/25 backdrop-blur-sm",accident:"bg-gradient-to-r from-orange-500/25 via-orange-400/10 to-orange-500/25 backdrop-blur-sm","not stock":"bg-gradient-to-r from-slate-500/25 via-slate-400/10 to-slate-500/25 backdrop-blur-sm",stolen:"bg-gradient-to-r from-red-500/25 via-red-400/10 to-red-500/25 backdrop-blur-sm","m&t repo title in process":"bg-gradient-to-r from-blue-600/25 via-blue-500/10 to-blue-600/25 backdrop-blur-sm","repoed on hold":"bg-gradient-to-r from-blue-700/25 via-blue-500/10 to-blue-700/25 backdrop-blur-sm","third party repair shop":"bg-gradient-to-r from-yellow-300/20 via-yellow-200/10 to-yellow-300/20 backdrop-blur-sm","available for deals":"bg-gradient-to-r from-emerald-400/20 via-emerald-300/10 to-emerald-400/20 backdrop-blur-sm"},ut=e=>e.find(l=>/inv\.?\s*prep\.?\s*stat/i.test(l.key)||/inv\.?\s*prep\.?\s*stat/i.test(l.label)||/inventory\s*preparation\s*status/i.test(l.key)||/inventory\s*preparation\s*status/i.test(l.label))?.key||"",ht=(e,l)=>{const n=l?e?.[l]:void 0;if(n!=null&&n!=="")return String(n);const a=e?.prepStatus??e?.["Inventory Preparation Status"]??e?.["Inv. Prep. Stat"];return a!=null&&a!==""?String(a):""},mt=e=>{if(!e)return"";const l=String(e).trim().toLowerCase();return dt[l]||""},ft=(e,l,n)=>e.filter(s=>!n.includes(s.key)).filter(s=>["string","number","boolean"].includes(s.type)).map(s=>({key:s.key,label:s.label,values:te(l,s.key)})).filter(s=>s.values.length>0&&s.values.length<=50).sort((s,i)=>i.values.length-s.values.length).slice(0,4),ce=e=>e.id??"",Q=e=>{if(typeof e=="boolean")return e;if(typeof e=="number")return e!==0;if(typeof e=="string"){const l=e.trim().toLowerCase();return["true","yes","y","1"].includes(l)}return!!e},gt=e=>{const l=String(e??"").trim();if(!l)return"Active";const n=l.toLowerCase();return n.includes("hold")?"On Hold":n.includes("transit")?"In Transit":n.includes("recover")?"Recovery":n.includes("ready")?"Ready":n.includes("write")?"Write-Off":(n.includes("active"),"Active")},pt=e=>{if(e==null||typeof e!="string")return e;const l=e.trim();if(!l)return l;const n=l.toUpperCase();return n==="COPART"||n==="CO PART - PENDING FUNDING"||n==="CO PART- PENDING FUNDING"?"COPART":n==="EXTERNAL DEALER FOR FINANCE EXTERNAL DEAL"?"External Dealer":n==="HOUSBY TRUCK & EQUIPMENT SOLUTIONS, LLC"?"HOUSBY":l},H=(e,...l)=>{for(const n of l){const a=e?.[n];if(a!=null&&a!=="")return a}return""},Fe=e=>{const l=H(e,"Updated At","Updated","Last Updated"),n=H(e,"Created At"),a=H(e,"Date")||l||n,s=H(e,"VIN"),i=e.id||H(e,"Current Stock No")||s,u=H(e,"Physical Location"),f=pt(u);return{...e,id:i||null,stockNo:H(e,"Current Stock No"),vin:s,status:gt(H(e,"Vehicle Status")),hold:Q(H(e,"HOLD")),isLastDeal:Q(H(e,"Last Deal","last_deal")),brand:H(e,"Brand"),model:H(e,"Model"),modelYear:H(e,"Model Year"),dealStatus:H(e,"Deal Status"),gpsStatus:H(e,"gps_status"),gpsFlag:H(e,"gps_review_flag"),completion:H(e,"Deal Completion"),psrCategory:H(e,"PSR Category"),prepStatus:H(e,"Inventory Preparation Status"),createdAt:n?String(n).slice(0,10):"",updatedAt:l?String(l).slice(0,10):"",date:a?String(a).slice(0,10):"",lastEventAt:e.lastEventAt||(l?new Date(l).getTime():null),"Physical Location":f}},Pe=e=>{const l=t.table.columnOrder;if(!Array.isArray(l)||!l.length)return e;const n=new Map(e.map(s=>[s.key,s])),a=l.map(s=>n.get(s)).filter(Boolean);return e.forEach(s=>{l.includes(s.key)||a.push(s)}),a},yt=()=>({table:{columns:t.table.columns,columnOrder:t.table.columnOrder,columnWidths:t.table.columnWidths,sort:t.table.sort,perPage:t.table.perPage,columnLabels:t.table.columnLabels},chart:{chartSegments:t.chartSegments,chartVisibility:t.chartVisibility},filters:{dateRange:t.filters.dateRange,salesChannels:t.filters.salesChannels,lastLeadSelection:t.filters.lastLeadSelection,categoryFilters:t.filters.categoryFilters,columnFilters:t.filters.columnFilters,chartFilters:t.filters.chartFilters,unitTypeSelection:t.filters.unitTypeSelection,vehicleStatusSelection:t.filters.vehicleStatusSelection},layout:{alertsPanelWidth:t.layout.alertsPanelWidth,chartSplitWidth:t.layout.chartSplitWidth,dealPanelHeight:t.layout.dealPanelHeight,fullChartHeight:t.layout.fullChartHeight,fullChartCollapsed:t.layout.fullChartCollapsed}}),bt=e=>{if(!(!e||typeof e!="object")){if(e.table?.sort&&(t.table.sort=e.table.sort),typeof e.table?.perPage=="number"&&(t.table.perPage=e.table.perPage),Array.isArray(e.table?.columnOrder)&&(t.table.columnOrder=e.table.columnOrder),e.table?.columnWidths&&(t.table.columnWidths=e.table.columnWidths),e.table?.columnLabels&&typeof e.table.columnLabels=="object"&&(t.table.columnLabels=e.table.columnLabels),et(),e.chart?.chartSegments&&typeof e.chart.chartSegments=="object"&&(t.chartSegments={...e.chart.chartSegments}),e.chart?.chartVisibility&&typeof e.chart.chartVisibility=="object"&&(t.chartVisibility={...e.chart.chartVisibility}),e.chart?.segmentKey&&(!e.chart.chartSegments||typeof e.chart.chartSegments!="object")&&(t.chartSegments={default:e.chart.segmentKey}),e.filters?.dateRange&&(t.filters.dateRange={...t.filters.dateRange,...e.filters.dateRange}),Array.isArray(e.filters?.salesChannels)&&(t.filters.salesChannels=e.filters.salesChannels),(e.filters?.lastLeadSelection==="all"||typeof e.filters?.lastLeadSelection=="boolean")&&(t.filters.lastLeadSelection=e.filters.lastLeadSelection),e.filters?.categoryFilters&&(t.filters.categoryFilters=e.filters.categoryFilters),e.filters?.columnFilters&&(t.filters.columnFilters=e.filters.columnFilters),e.filters?.chartFilters&&typeof e.filters?.chartFilters=="object"&&(t.filters.chartFilters=Object.entries(e.filters.chartFilters).reduce((l,[n,a])=>{if(!a||typeof a!="object")return l;const s=a.key||Y,i=Array.isArray(a.values)?a.values.map(u=>String(u)):a.value?[String(a.value)]:[];return i.length&&(l[n]={key:s,values:i}),l},{})),!Object.keys(t.filters.chartFilters||{}).length&&e.filters?.chartFilter&&typeof e.filters.chartFilter=="object"){const l=e.filters.chartFilter.key||Y,n=e.filters.chartFilter.value;t.filters.chartFilters=n?{default:{key:l,values:[String(n)]}}:{}}Array.isArray(e.filters?.unitTypeSelection)?t.filters.unitTypeSelection=e.filters.unitTypeSelection.map(l=>String(l)):typeof e.filters?.unitTypeSelection=="string"&&(t.filters.unitTypeSelection=[e.filters.unitTypeSelection]),Array.isArray(e.filters?.vehicleStatusSelection)?t.filters.vehicleStatusSelection=e.filters.vehicleStatusSelection.map(l=>String(l)):typeof e.filters?.vehicleStatusSelection=="string"&&(t.filters.vehicleStatusSelection=[e.filters.vehicleStatusSelection]),typeof e.layout?.alertsPanelWidth=="number"&&(t.layout.alertsPanelWidth=e.layout.alertsPanelWidth),typeof e.layout?.chartSplitWidth=="number"&&(t.layout.chartSplitWidth=e.layout.chartSplitWidth),typeof e.layout?.dealPanelHeight=="number"&&(t.layout.dealPanelHeight=e.layout.dealPanelHeight),typeof e.layout?.fullChartHeight=="number"&&(t.layout.fullChartHeight=e.layout.fullChartHeight),typeof e.layout?.fullChartCollapsed=="boolean"&&(t.layout.fullChartCollapsed=e.layout.fullChartCollapsed)}},xe=async e=>{if(!F?.from||!e)return null;const{data:l,error:n}=await F.from(Be).select("config").eq("user_id",e).eq("table_name",Te).maybeSingle();return n?null:l?.config||null},St=async()=>{if(!F?.from)return null;const{data:e,error:l}=await F.from("profiles").select("id").eq("role","administrator").limit(1).maybeSingle();return l?null:e?.id||null},vt=async()=>{let e=null;if(F?.auth){const{data:l}=await F.auth.getSession(),n=l?.session?.user?.id||null;if(t.preferences.userId=n,n&&(e=await xe(n),!e)){const a=await St();a&&(e=await xe(a))}}if(!e)try{const l=localStorage.getItem(Ae);e=l?JSON.parse(l):null}catch{}e&&(t.preferences.config=e,bt(e))},xt=()=>{const e=document.getElementById("alerts-panel"),l=document.getElementById("deal-status-panel"),n=document.getElementById("status-primary-card"),a=document.getElementById("status-secondary-card"),s=document.querySelectorAll("[data-full-chart-card]"),i=document.querySelectorAll("[data-full-chart-body]"),u=document.querySelectorAll("[data-full-chart-toggle]"),f=document.getElementById("full-chart-height-resizer");if(!(!e||!l)){if(typeof t.layout.alertsPanelWidth=="number"&&window.innerWidth>=1024&&(e.style.flex=`0 0 ${t.layout.alertsPanelWidth}px`,l.style.flex="1 1 auto"),typeof t.layout.chartSplitWidth=="number"&&window.innerWidth>=1024&&n&&a&&(n.style.flex=`0 0 ${t.layout.chartSplitWidth}px`,a.style.flex="1 1 auto"),typeof t.layout.fullChartHeight=="number"&&s.length&&s.forEach(b=>{b.style.height=`${t.layout.fullChartHeight}px`}),s.length&&i.length&&u.length&&f){const b="220px",p=!!t.layout.fullChartCollapsed;s.forEach(S=>{S.dataset.collapsed=String(p)}),i.forEach(S=>S.classList.toggle("hidden",p)),f.classList.toggle("hidden",p),u.forEach(S=>{S.setAttribute("aria-expanded",String(!p));const x=S.querySelector("i[data-lucide]");x&&x.setAttribute("data-lucide",p?"chevron-down":"chevron-up")}),p&&s.forEach(S=>{S.style.height="",S.style.minHeight="0px"}),p||s.forEach(S=>{S.style.minHeight=b})}if(typeof t.layout.dealPanelHeight=="number"&&window.innerWidth>=1024){const b=`${t.layout.dealPanelHeight}px`;l.style.height=b,e.style.height=b,n&&(n.style.height=b),a&&(a.style.height=b)}}},Lt=async()=>{const e=yt();try{localStorage.setItem(Ae,JSON.stringify(e)),localStorage.setItem(Ie,JSON.stringify(t.table.columns))}catch{}!F?.from||!t.preferences.userId||await F.from(Be).upsert({user_id:t.preferences.userId,table_name:Te,config:e},{onConflict:"user_id, table_name"})},T=()=>{t.preferences.saveTimer&&window.clearTimeout(t.preferences.saveTimer),t.preferences.saveTimer=window.setTimeout(()=>{Lt()},500)},ne=()=>Array.from(t.vehiclesRaw.values()),Et=e=>{t.vehiclesRaw.clear(),e.forEach(l=>{const n=Fe(l),a=ce(n);a&&t.vehiclesRaw.set(a,n)})},J=({preserveSelections:e=!1}={})=>{const l=ne(),n=t.schema;if(!n.length)return;const a=st(n),s=rt(n),i=it(n),u=ot(n),f=ct(n),b=ft(n,l,[a,s,u,f].filter(Boolean));e||(t.filters.categoryFilters={},t.filters.columnFilters={},t.filters.unitTypeSelection=[],t.filters.vehicleStatusSelection=[]),t.filters.dateKey=a,t.filters.salesChannelKey=s,t.filters.lastLeadKey=i,t.filters.unitTypeKey=u,t.filters.vehicleStatusKey=f;const p=document.getElementById("filter-builder"),S=document.getElementById("filter-category-block"),x=document.getElementById("filter-date-range"),I=document.getElementById("sales-channel-options"),O=document.getElementById("sales-channel-summary"),P=document.getElementById("sales-channel-label"),$=document.getElementById("last-deal-select"),A=i;if(!p&&!S&&!x&&!e&&(t.filters.dateRange={start:"",end:""}),S&&(S.innerHTML=""),x&&(x.innerHTML=""),S&&b.length&&b.forEach(c=>{const h=e&&t.filters.categoryFilters[c.key]||"all";t.filters.categoryFilters[c.key]=h,S.insertAdjacentHTML("beforeend",`
            <label class="col-span-12 flex flex-col gap-1 text-[10px] font-semibold uppercase tracking-[0.2em] text-slate-400 sm:col-span-6 lg:col-span-3">
              ${c.label}
              <select data-filter-category="${c.key}" class="h-9 rounded-xl border border-slate-800 bg-slate-950/70 px-3 text-sm font-semibold text-white">
                <option value="all">All ${c.label}</option>
                ${c.values.map(g=>`<option value="${g}" ${g===h?"selected":""}>${g}</option>`).join("")}
              </select>
            </label>
          `)}),x&&a){const c=at(l,a).map(h=>new Date(h)).filter(h=>!Number.isNaN(h.getTime())).map(h=>h.toISOString().slice(0,10)).sort();if(c.length&&!e){const h=new Date(c[c.length-1]),g=new Date(h);g.setDate(g.getDate()-29),t.filters.dateRange={start:g.toISOString().slice(0,10),end:""}}else c.length?t.filters.dateRange.end="":t.filters.dateRange={start:"",end:""};x.innerHTML=`
          <div class="grid gap-2 sm:grid-cols-2">
            <label class="flex items-center gap-2 text-[10px] font-semibold uppercase tracking-[0.2em] text-slate-400">
              <span>Start</span>
              <input id="filter-start-date" type="date" value="${t.filters.dateRange.start||""}" class="h-8 flex-1 rounded-xl border border-slate-800 bg-slate-950/70 px-2 text-[11px] font-semibold text-white" />
            </label>
          </div>
        `}if(I&&O)if(s){const c=te(l,s),h=["Finance-EX","Finance-EXT","Finance-ext","Finance-Ext"],g=t.filters.salesChannels.filter(v=>c.includes(v));if(!e||!g.length){const v=h.filter(B=>c.includes(B));if(v.length)t.filters.salesChannels=v;else{const B=c.find(L=>L.toUpperCase()!=="FINANCE");t.filters.salesChannels=B?[B]:[...c]}}else t.filters.salesChannels=g;I.innerHTML=(c.length?c:[""]).map(v=>`
              <label class="flex items-center gap-2 text-xs">
                <input type="checkbox" value="${v}" class="h-3.5 w-3.5 rounded border-slate-600 bg-slate-950" ${t.filters.salesChannels.includes(v)?"checked":""} />
                <span>${v||"Unknown"}</span>
              </label>
            `).join("");const y=t.filters.salesChannels.filter(Boolean).length;O.textContent=y?String(y):"0",P&&(P.textContent=y===1?t.filters.salesChannels[0]:"Sales Channel")}else t.filters.salesChannels=[],I.innerHTML='<p class="text-[10px] text-slate-400">No channels available.</p>',O.textContent="0",P&&(P.textContent="Sales Channel");if($){if(A){const c=t.filters.columnFilters[A];e||(t.filters.lastLeadSelection=!0),e&&c?.select&&c.select!=="all"?t.filters.lastLeadSelection=Q(c.select):e&&c?.select==="all"&&(t.filters.lastLeadSelection="all"),t.filters.lastLeadFilterActive=t.filters.lastLeadSelection!=="all",t.filters.columnFilters[A]={select:t.filters.lastLeadSelection==="all"?"all":t.filters.lastLeadSelection?"true":"false",search:""}}else e||(t.filters.lastLeadFilterActive=!1);$.disabled=!A,$.classList.toggle("opacity-50",!A),$.classList.toggle("cursor-not-allowed",!A),$.value=t.filters.lastLeadSelection==="all"?"all":t.filters.lastLeadSelection?"true":"false"}S?.classList.toggle("hidden",b.length===0),x?.classList.toggle("hidden",!a),p?.classList.toggle("opacity-50",t.ui.isLoading)},He=({ignoreChartFilter:e=!1,ignoreChartId:l=null}={})=>{const{filters:n}=t;return ne().filter(a=>{if(n.lastLeadFilterActive&&n.lastLeadSelection!=="all"&&a.isLastDeal!==n.lastLeadSelection)return!1;const s=n.dateKey?a[n.dateKey]:null,i=s?new Date(s):null,u=i&&!Number.isNaN(i.getTime())?i.toISOString().slice(0,10):"",f=!n.dateKey||(!n.dateRange.start||u>=n.dateRange.start)&&(!n.dateRange.end||u<=n.dateRange.end);if((n.dateRange.start||n.dateRange.end)&&!u)return!1;const b=Object.entries(n.categoryFilters||{}).every(([c,h])=>h==="all"?!0:String(a[c]??"")===h),p=!n.salesChannelKey||!n.salesChannels.length||n.salesChannels.includes(String(a[n.salesChannelKey]??"")),S=Array.isArray(n.unitTypeSelection)?n.unitTypeSelection:[],x=!n.unitTypeKey||!S.length||S.includes(String(a[n.unitTypeKey]??"")),I=Array.isArray(n.vehicleStatusSelection)?n.vehicleStatusSelection:[],O=!n.vehicleStatusKey||!I.length||I.includes(String(a[n.vehicleStatusKey]??"")),P=Object.entries(n.columnFilters||{}).every(([c,h])=>{if(!h)return!0;const g=a[c],y=String(g??"");if(n.lastLeadKey&&c===n.lastLeadKey&&n.lastLeadFilterActive){if(h.select&&h.select!=="all"){const v=Q(h.select);if(Q(g)!==v)return!1}}else if(h.select&&h.select!=="all"&&y!==h.select)return!1;return!(h.search&&!y.toLowerCase().includes(h.search))}),$=!e&&n.chartFilters?Object.entries(n.chartFilters).filter(([c])=>!l||c!==l).map(([,c])=>c):[],A=e||!$.length||$.every(c=>{const h=Array.isArray(c.values)?c.values:[];return h.length?h.includes(re(a[c.key])):!0});return f&&b&&p&&x&&O&&P&&A})},re=e=>String(e??"").trim()||"Unassigned",Ct=()=>{const e=[{key:"dealStatus",label:"Deal Status"}],l=new Set(e.map(n=>n.key));return t.schema.filter(n=>["string","number","boolean"].includes(n.type)).forEach(n=>{l.has(n.key)||(l.add(n.key),e.push({key:n.key,label:n.label||ee(n.key)}))}),e},de=(e,l)=>(t.chartVisibility[e]||(t.chartVisibility[e]={}),Array.isArray(t.chartVisibility[e][l])||(t.chartVisibility[e][l]=[]),t.chartVisibility[e][l]),Z=(e,l,n)=>{t.chartVisibility[e]||(t.chartVisibility[e]={}),t.chartVisibility[e][l]=n;const a=t.filters.chartFilters||{};Object.entries(a).forEach(([s,i])=>{if(i.key!==l)return;const f=(Array.isArray(i.values)?i.values:[]).filter(b=>!n.includes(b));f.length?t.filters.chartFilters[s]={key:l,values:f}:delete t.filters.chartFilters[s]})},Le=(e,l,n)=>{const a=document.querySelector(`[data-segment-filter-panel][data-chart-id="${e}"]`),s=document.querySelector(`[data-segment-filter-options][data-chart-id="${e}"]`),i=document.querySelector(`[data-segment-filter-count][data-chart-id="${e}"]`);if(!a||!s||!i)return;a.dataset.segmentKey=l,t.chartVisibilityOptions[e]||(t.chartVisibilityOptions[e]={}),t.chartVisibilityOptions[e][l]=n;const u=de(e,l),f=new Set(u),b=n.reduce((S,x)=>S+(f.has(x)?1:0),0);Z(e,l,u.slice());const p=Math.max(0,n.length-b);if(i.textContent=n.length?`${p}/${n.length}`:"0",!n.length){s.innerHTML='<p class="text-[11px] text-slate-400">No fields available.</p>';return}s.innerHTML=n.map(S=>{const x=String(S),I=x.replace(/"/g,"&quot;"),O=!u.includes(x);return`
          <label class="flex items-center gap-2 rounded-xl border border-slate-800 bg-slate-950/60 px-2 py-1 text-[11px] font-semibold text-slate-200">
            <input type="checkbox" class="h-3.5 w-3.5 rounded border-slate-700 bg-slate-950 text-blue-400" data-segment-field-checkbox data-chart-id="${e}" data-segment-key="${l}" value="${I}" ${O?"checked":""} />
            <span class="truncate">${x}</span>
          </label>
        `}).join("")},Ee=()=>{const e=document.getElementById("unit-type-filters");if(!e)return;const l=t.filters.unitTypeKey;if(!l){e.classList.add("hidden"),e.innerHTML="";return}const n=te(ne(),l),a=Array.isArray(t.filters.unitTypeSelection)?t.filters.unitTypeSelection.filter(f=>n.includes(f)):[];if(t.filters.unitTypeSelection=a,!n.length){e.classList.add("hidden"),e.innerHTML="";return}e.classList.remove("hidden");const s=n.map(f=>`
        <label class="flex items-center gap-2 text-xs">
          <input type="checkbox" value="${f}" class="h-3.5 w-3.5 rounded border-slate-600 bg-slate-950" ${a.includes(f)?"checked":""} />
          <span>${f}</span>
        </label>
      `).join(""),i=a.length,u=i===1?a[0]:"Unit Type";e.innerHTML=`
        <div class="relative">
          <button id="unit-type-toggle" type="button" class="flex items-center gap-2 rounded-2xl border border-slate-700 bg-slate-950/60 px-3 py-2 text-[10px] font-semibold uppercase tracking-[0.2em] text-slate-200" aria-expanded="false">
            <span id="unit-type-label">${u}</span>
            <span id="unit-type-summary" class="rounded-full border border-slate-700 bg-slate-950/80 px-2 py-0.5 text-[10px] font-semibold text-slate-300">${i}</span>
          </button>
          <div id="unit-type-panel" class="absolute left-1/2 z-40 mt-2 hidden w-56 max-w-[calc(100vw-2rem)] -translate-x-1/2 rounded-2xl border border-slate-800 bg-slate-950/95 p-3 text-xs text-slate-200 shadow-lg">
            <p class="text-[10px] font-semibold uppercase tracking-[0.3em] text-slate-400">Choose unit types</p>
            <div id="unit-type-options" class="mt-2 grid gap-2">
              ${s}
            </div>
          </div>
        </div>
      `},Ce=()=>{const e=document.getElementById("vehicle-status-filters");if(!e)return;const l=t.filters.vehicleStatusKey;if(!l){e.classList.add("hidden"),e.innerHTML="";return}const n=te(ne(),l),a=Array.isArray(t.filters.vehicleStatusSelection)?t.filters.vehicleStatusSelection.filter(f=>n.includes(f)):[];if(t.filters.vehicleStatusSelection=a,!n.length){e.classList.add("hidden"),e.innerHTML="";return}e.classList.remove("hidden");const s=n.map(f=>`
        <label class="flex items-center gap-2 text-xs">
          <input type="checkbox" value="${f}" class="h-3.5 w-3.5 rounded border-slate-600 bg-slate-950" ${a.includes(f)?"checked":""} />
          <span>${f}</span>
        </label>
      `).join(""),i=a.length,u=i===1?a[0]:"Vehicle Status";e.innerHTML=`
        <div class="relative">
          <button id="vehicle-status-toggle" type="button" class="flex items-center gap-2 rounded-2xl border border-slate-700 bg-slate-950/60 px-3 py-2 text-[10px] font-semibold uppercase tracking-[0.2em] text-slate-200" aria-expanded="false">
            <span id="vehicle-status-label">${u}</span>
            <span id="vehicle-status-summary" class="rounded-full border border-slate-700 bg-slate-950/80 px-2 py-0.5 text-[10px] font-semibold text-slate-300">${i}</span>
          </button>
          <div id="vehicle-status-panel" class="absolute left-1/2 z-40 mt-2 hidden w-56 max-w-[calc(100vw-2rem)] -translate-x-1/2 rounded-2xl border border-slate-800 bg-slate-950/95 p-3 text-xs text-slate-200 shadow-lg">
            <p class="text-[10px] font-semibold uppercase tracking-[0.3em] text-slate-400">Choose vehicle status</p>
            <div id="vehicle-status-options" class="mt-2 grid gap-2">
              ${s}
            </div>
          </div>
        </div>
      `},wt=()=>{const e=document.querySelectorAll("[data-segment-select]");if(!e.length)return;const l=Ct(),n=l[0]?.key||Y,a=l.map(s=>`<option value="${s.key}">${s.label}</option>`).join("");e.forEach(s=>{const i=s.dataset.chartId||"default",u=t.chartSegments[i]||t.chartSegments.default,f=l.some(b=>b.key===u)?u:n;t.chartSegments[i]=f,s.innerHTML=a,s.value=f})},kt=()=>{const e=He(),l=Array.from(e.reduce((s,i)=>{const u=i.stockNo||i.vin||i.id;return u&&(s.has(u)||s.set(u,i)),s},new Map).values()),n=l.filter(s=>s.status==="Active").length,a=l.filter(s=>s.hold||s.status==="On Hold").length;t.derived={filtered:e,kpis:{active:n,hold:a}}},It=()=>{const{kpis:e}=t.derived,l=t.ui.isLoading,n=document.querySelector('[data-metric="active"]'),a=document.querySelector('[data-metric="hold"]');if([n,a].forEach(s=>s.classList.toggle("animate-pulse",l)),l){n.textContent=a.textContent="...";return}n.textContent=G(e.active),a.textContent=G(e.hold)},At=()=>{const e=document.querySelectorAll("[data-bar-chart]");wt(),e.forEach(l=>{const n=l.dataset.chartId||"default",a=t.chartSegments[n]||t.chartSegments.default||Y,s=n==="status-secondary"?Je:Xe;if(t.ui.isLoading){Le(n,a,[]),l.innerHTML=Array.from({length:6}).map(()=>`
            <div class="flex h-full flex-col items-center justify-end">
              <span class="mb-1 text-[11px] font-semibold text-slate-500">...</span>
              <div class="h-full min-h-[140px] w-8 rounded-full bg-slate-800/70 overflow-hidden">
                <div class="h-full w-full animate-pulse bg-slate-700/70"></div>
              </div>
              <span class="mt-2 text-[10px] uppercase tracking-[0.2em] text-slate-500">...</span>
            </div>
          `).join("");return}const i=t.derived.filtered,u=He({ignoreChartId:n}),f=Array.from(i.reduce((c,h)=>{const g=h.stockNo||h.vin||h.id;return g&&(c.has(g)||c.set(g,h)),c},new Map).values()),b=Array.from(u.reduce((c,h)=>{const g=h.stockNo||h.vin||h.id;return g&&(c.has(g)||c.set(g,h)),c},new Map).values()),p=f.reduce((c,h)=>{const g=re(h[a]);return c[g]=(c[g]||0)+1,c},{}),S=Array.from(new Set(b.map(c=>re(c[a])))).sort((c,h)=>c.localeCompare(h));Le(n,a,S);const x=de(n,a),I=new Set(x),O=Object.entries(p).reduce((c,[h,g])=>(c[h]=g,c),{}),P=S.filter(c=>!I.has(c)).map(c=>({status:c,count:O[c]||0})).sort((c,h)=>c.status.localeCompare(h.status)),$=Math.max(1,...P.map(c=>c.count)),A=P.map((c,h)=>({...c,percentage:Math.round(c.count/$*100),color:s[h%s.length]}));if(!A.length){l.innerHTML=S.length?'<p class="col-span-6 text-center text-xs text-slate-400">All fields are hidden.</p>':'<p class="col-span-6 text-center text-xs text-slate-400">No vehicles match current filters.</p>';return}l.innerHTML=A.map(c=>{const h=t.filters.chartFilters?.[n],g=Array.isArray(h?.values)?h.values:[],y=h&&h.key===a&&g.includes(c.status),v=h&&g.length>0&&!y,B=y?"ring-2 ring-blue-400/70 bg-slate-900/50":"",L=v?"opacity-40 grayscale cursor-not-allowed":"",N=v?"":"hover:bg-slate-900/60",K=v?"text-slate-500":"text-slate-200",D=v?"text-slate-500":"text-slate-400",W=v?'disabled aria-disabled="true"':"";return`
          <button type="button" data-status="${c.status}" data-segment-key="${a}" data-chart-id="${n}" class="group flex h-full flex-col items-center justify-end rounded-2xl px-1 py-1 transition ${N} ${B} ${L}" ${W}>
            <span class="mb-1 text-[11px] font-semibold ${K}">${c.count}</span>
            <div class="flex h-full min-h-[140px] w-8 items-end rounded-full bg-slate-800/70">
              <div class="bar-fill w-full rounded-full bg-gradient-to-t ${c.color}" style="height: 0%;" data-height="${c.percentage}%"></div>
            </div>
            <span class="mt-2 text-[10px] uppercase tracking-[0.2em] transition duration-200 ease-out group-hover:scale-110 group-hover:text-slate-100 ${D}">${c.status}</span>
          </button>
        `}).join(""),requestAnimationFrame(()=>{l.querySelectorAll(".bar-fill").forEach(c=>{const h=c.dataset.height;h&&(c.style.height=h)})})})},Bt=()=>{const e=document.getElementById("active-filters");if(!e)return;const{filters:l}=t,n=[];l.dateRange.start&&n.push(`Date: From ${l.dateRange.start}`),l.salesChannelKey&&l.salesChannels.length&&n.push(`${X(l.salesChannelKey)}: ${l.salesChannels.join(", ")}`);const a=Array.isArray(l.unitTypeSelection)?l.unitTypeSelection:[];l.unitTypeKey&&a.length&&n.push(`${X(l.unitTypeKey)}: ${a.join(", ")}`);const s=Array.isArray(l.vehicleStatusSelection)?l.vehicleStatusSelection:[];l.vehicleStatusKey&&s.length&&n.push(`${X(l.vehicleStatusKey)}: ${s.join(", ")}`),Object.entries(l.categoryFilters||{}).forEach(([i,u])=>{u!=="all"&&n.push(`${X(i)}: ${u}`)}),Object.values(l.chartFilters||{}).forEach(i=>{const u=Array.isArray(i.values)?i.values:[];u.length&&n.push(`${X(i.key)}: ${u.join(", ")}`)}),e.innerHTML=n.length?n.map(i=>`<span class="${se} whitespace-nowrap text-slate-200">${i}</span>`).join(""):'<span class="text-slate-400">No active filters</span>'},Tt=()=>{const e=document.getElementById("inventory-table-head"),l=Pe(t.schema).filter(i=>t.table.columns[i.key]),n=t.table.sort,a=document.getElementById("inventory-table-cols"),s=ne();if(!l.length){e.innerHTML='<tr><th class="px-3 py-2 text-left text-[10px] uppercase tracking-[0.3em] text-slate-400">No columns</th></tr>',a&&(a.innerHTML="");return}a&&(a.innerHTML=l.map(i=>{const u=t.table.columnWidths[i.key],f=typeof u=="number"?` style="width: ${u}px"`:"";return`<col data-col-key="${i.key}"${f} />`}).join("")),e.innerHTML=`
        <tr>${l.map(i=>{const f=n.key===i.key?n.direction==="asc"?"▲":"▼":"",b=t.table.columnWidths[i.key],p=typeof b=="number"?` style="width: ${b}px"`:"",S=te(s,i.key).slice(0,50),x=t.filters.columnFilters[i.key]||{select:"all",search:""};return t.filters.columnFilters[i.key]=x,`
              <th class="relative px-3 py-2" data-col-key="${i.key}" draggable="true"${p}>
                <div class="flex items-center gap-2">
                  <button type="button" data-sort="${i.key}" class="flex items-center gap-1 text-left text-[10px] uppercase tracking-[0.3em] text-slate-400" aria-label="Sort by ${i.label}">
                    <span class="whitespace-normal break-words">${i.label}</span>
                    <span class="text-[10px] text-blue-300">${f}</span>
                  </button>
                  <button type="button" data-column-filter-toggle="${i.key}" class="inline-flex h-5 w-5 items-center justify-center rounded-full border border-slate-800 bg-slate-950/70 text-slate-300 transition hover:text-white" aria-label="Filter ${i.label}">
                    <i data-lucide="sliders-horizontal" class="h-3 w-3"></i>
                  </button>
                </div>
                <div class="column-filter-panel absolute left-0 top-full z-40 mt-2 hidden w-56 max-w-[calc(100vw-2rem)] rounded-2xl border border-slate-800 bg-slate-950/95 p-3 text-[10px] font-semibold text-slate-200 shadow-lg" data-column-filter-panel="${i.key}">
                  <p class="text-[10px] uppercase tracking-[0.3em] text-slate-400">${i.label}</p>
                  <div class="mt-2 grid gap-1">
                    <select data-column-filter="${i.key}" class="h-7 rounded-lg border border-slate-800 bg-slate-950/70 px-2 text-[10px] font-semibold text-slate-200">
                      <option value="all">All</option>
                      ${S.map(I=>`<option value="${I}" ${x.select===I?"selected":""}>${I}</option>`).join("")}
                    </select>
                    <input type="search" data-column-search="${i.key}" value="${x.search||""}" placeholder="Search" class="h-7 rounded-lg border border-slate-800 bg-slate-950/70 px-2 text-[10px] font-semibold text-slate-200" />
                  </div>
                </div>
                <span class="column-resizer absolute right-0 top-2 h-4 w-2 cursor-col-resize rounded-full bg-slate-800/60 transition hover:bg-slate-500/80" data-resize-handle="${i.key}"></span>
              </th>
            `}).join("")}</tr>
      `},$t=()=>{const e=document.getElementById("inventory-table"),l=Pe(t.schema).filter($=>t.table.columns[$.key]),n=Math.max(1,l.length),a=ut(t.schema);if(t.ui.isLoading){e.innerHTML=Array.from({length:t.table.perPage}).map(()=>`
          <tr class="text-xs">
            <td class="px-3 py-3" colspan="${n}">
              <div class="h-3 w-full rounded-full bg-slate-800/70 animate-pulse"></div>
            </td>
          </tr>
        `).join("");return}if(!l.length){e.innerHTML=`<tr><td class="px-3 py-6 text-center text-sm text-slate-400" colspan="${n}">No columns available.</td></tr>`;return}const s=[...t.derived.filtered].sort(($,A)=>{const{key:c,direction:h}=t.table.sort,g=t.schema.find(N=>N.key===c);if(!g)return 0;const y=N=>N[c],v=y($),B=y(A);let L=0;if(g.type==="date"){const N=W=>{if(W==null||W==="")return 0;if(W instanceof Date){const q=W.getTime();return Number.isNaN(q)?0:q}if(typeof W=="number")return Number.isFinite(W)?W:0;const V=Date.parse(String(W));return Number.isNaN(V)?0:V},K=N(v),D=N(B);L=K-D}else g.type==="number"?L=(Number(v)||0)-(Number(B)||0):g.type==="boolean"?L=(v?1:0)-(B?1:0):L=String(v??"").localeCompare(String(B??""),void 0,{sensitivity:"base"});return L===0?0:h==="asc"?L:-L}),i=s.length,u=Math.max(1,Math.ceil(i/t.table.perPage)),f=Math.min(t.table.page,u);t.table.page=f;const b=(f-1)*t.table.perPage,p=s.slice(b,b+t.table.perPage),S=i?b+1:0,x=i?b+p.length:0,I=p.map($=>{const A=ht($,a),c=mt(A),h=l.map(g=>{let y=$[g.key];g.type==="boolean"?y=y?"Yes":"No":g.type==="date"?y=y?oe(y):"--":Ge.has(g.key.toLowerCase())||g.label?.toLowerCase()==="mileage"?y=Qe(y):(ve.has(g.key.toLowerCase())||g.label&&ve.has(g.label.toLowerCase()))&&(y=Ze(y)),(y==null||y==="")&&(y="--");const v=t.table.columnWidths[g.key];return`<td class="px-3 py-2 whitespace-normal break-words"${typeof v=="number"?` style="width: ${v}px"`:""}>${y}</td>`}).join("");return`<tr class="text-xs ${c} hover:bg-slate-900/60 cursor-pointer transition" data-row-key="${ce($)}">${h}</tr>`}).join("");e.innerHTML=I||`<tr><td class="px-3 py-6 text-center text-sm text-slate-400" colspan="${n}">No vehicles match current filters.</td></tr>`,document.getElementById("table-summary").textContent=`${G(S)}–${G(x)} of ${G(i)}`,document.getElementById("table-page").textContent=`Page ${f} of ${u}`,document.getElementById("table-prev").disabled=f<=1,document.getElementById("table-next").disabled=f>=u;const O=document.getElementById("table-go-to");O&&(O.max=String(u),O.value=String(f));const P=document.getElementById("table-per-page");P&&(P.value=String(t.table.perPage))},w=()=>{Ee(),Ce(),kt(),Ee(),Ce(),It(),At(),Tt(),$t(),Bt(),ie(),lucide?.createIcons?.();const e=document.getElementById("inventory-loading");e&&e.classList.toggle("hidden",!t.ui.isLoading)},Oe=()=>{let e=t.preferences.config?.table?.columns||{};if(!Object.keys(e).length)try{const n=localStorage.getItem(Ie);e=n?JSON.parse(n):{}}catch{e={}}const l=t.schema.reduce((n,a)=>(n[a.key]=!0,n),{});if(t.table.columns=t.schema.reduce((n,a)=>(n[a.key]=e[a.key]??l[a.key]??!0,n),{}),!t.table.columnOrder.length)t.table.columnOrder=t.schema.map(n=>n.key);else{const n=new Set(t.schema.map(a=>a.key));t.table.columnOrder=t.table.columnOrder.filter(a=>n.has(a)),t.schema.forEach(a=>{t.table.columnOrder.includes(a.key)||t.table.columnOrder.push(a.key)})}t.schema.some(n=>n.key===t.table.sort.key)||(t.table.sort={key:t.schema[0]?.key||"",direction:"asc"}),Ft()},Ft=()=>{const e=document.getElementById("column-chooser-options");if(!t.schema.length){e.innerHTML='<p class="text-xs text-slate-400">No columns available.</p>';return}const l=[...t.schema].sort((n,a)=>n.label.localeCompare(a.label));e.innerHTML=l.map(n=>`
        <label class="flex items-center gap-2 text-xs">
          <input type="checkbox" value="${n.key}" class="h-3.5 w-3.5 rounded border-slate-600 bg-slate-950" ${t.table.columns[n.key]?"checked":""} />
          <span class="flex-1">${n.label}</span>
          <button type="button" class="rounded-full border border-slate-700 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-[0.2em] text-slate-300 transition hover:border-blue-500 hover:text-white" data-column-edit="${n.key}">
            Edit
          </button>
        </label>
      `).join("")},Pt=e=>{document.getElementById("drawer-vin").textContent=e.vin||"--",document.getElementById("drawer-status").textContent=e.status||"--",document.getElementById("drawer-gps-status").textContent=e.gpsStatus||"--",document.getElementById("drawer-gps-flag").textContent=e.gpsFlag?`⚠️ ${e.gpsFlag}`:"—";const l=e.completion;let n="--";if(l!=null&&l!==""){const i=String(l).trim();n=i?i.endsWith("%")?i:`${i}%`:"--"}document.getElementById("drawer-completion").textContent=n,document.getElementById("drawer-location").textContent=`${e.yard||"--"}, ${e.state||"--"}`,document.getElementById("drawer-unit").textContent=`${e.brand||"--"} ${e.unitType||""}`.trim()||"--";const a=[e.gpsOffline?"GPS Offline":null,e.hold?"Hold":null,e.lien?"Lien":null,e.recoveryPriority?"Recovery Priority":null].filter(Boolean).join(" • ");document.getElementById("drawer-flags").textContent=a||"None";const s=[{label:"Created",value:e.createdAt||e.date},{label:"Last updated",value:e.updatedAt||e.date}];document.getElementById("drawer-timeline").innerHTML=s.map(i=>`
        <li class="flex items-center justify-between rounded-xl border border-slate-800 bg-slate-900/70 px-3 py-2">
          <span>${i.label}</span>
          <span class="text-slate-200">${i.value?oe(i.value):"--"}</span>
        </li>
      `).join(""),document.getElementById("row-drawer").classList.remove("translate-x-full")},Ht=()=>document.getElementById("row-drawer").classList.add("translate-x-full"),Ot=()=>{const e=t.schema.filter(f=>t.table.columns[f.key]);if(!e.length)return;const l=t.derived.filtered.map(f=>e.map(b=>{let p=f[b.key];return b.type==="boolean"&&(p=p?"Yes":"No"),b.type==="date"&&(p=p?oe(p):""),`"${String(p??"").replace(/\"/g,'""')}"`})),a=[e.map(f=>`"${f.label}"`).join(","),...l.map(f=>f.join(","))].join(`
`),s=new Blob([a],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(s),u=document.createElement("a");u.href=i,u.download="inventory-export.csv",document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(i)};let ie=()=>{};const Nt=()=>{const e=document.getElementById("filter-builder"),l=document.getElementById("reset-filters"),n=document.getElementById("table-prev"),a=document.getElementById("table-next"),s=document.getElementById("table-per-page"),i=document.getElementById("table-go-to"),u=document.getElementById("inventory-table-head"),f=document.getElementById("inventory-table"),b=document.getElementById("inventory-table-scroll"),p=document.getElementById("inventory-table-scroll-top"),S=document.getElementById("inventory-table-scroll-top-inner"),x=document.getElementById("sales-channel-toggle"),I=document.getElementById("sales-channel-panel"),O=document.getElementById("sales-channel-options"),P=document.getElementById("sales-channel-summary"),$=document.getElementById("sales-channel-label"),A=document.getElementById("unit-type-filters"),c=document.getElementById("unit-type-toggle"),h=document.getElementById("unit-type-panel");document.getElementById("unit-type-options"),document.getElementById("unit-type-summary"),document.getElementById("unit-type-label");const g=document.getElementById("vehicle-status-filters"),y=document.getElementById("vehicle-status-toggle"),v=document.getElementById("vehicle-status-panel");document.getElementById("vehicle-status-options"),document.getElementById("vehicle-status-summary"),document.getElementById("vehicle-status-label");const B=document.getElementById("last-deal-select"),L=document.getElementById("alerts-toggle"),N=document.getElementById("alerts-list"),K=document.getElementById("alerts-badges"),D=document.getElementById("alerts-panel"),W=document.getElementById("drawer-close"),V=document.getElementById("column-chooser"),q=document.getElementById("column-chooser-toggle"),ue=document.getElementById("column-chooser-options"),Ne=document.getElementById("export-csv"),Re=document.querySelectorAll("[data-segment-select]"),De=document.querySelectorAll("[data-bar-chart]"),Me=document.querySelectorAll("[data-segment-filter-toggle]"),We=document.querySelectorAll("[data-segment-filter-panel]"),le=document.querySelectorAll("[data-full-chart-toggle]"),he=document.querySelectorAll("[data-full-chart-body]"),ae=document.querySelectorAll("[data-full-chart-card]"),me=document.getElementById("full-chart-height-resizer"),C=(o,r,d,m)=>{o?.addEventListener(r,d,m)},z=()=>t.table.page=1;let j=null,R=null;if(b&&p&&S){const o=b.querySelector("table"),r=()=>{o&&(S.style.width=`${o.scrollWidth}px`)},d=(m,E)=>{E.scrollLeft!==m.scrollLeft&&(E.scrollLeft=m.scrollLeft)};if(ie=()=>{r()},r(),o){const m=new ResizeObserver(r);m.observe(o),m.observe(b)}C(b,"scroll",()=>d(b,p)),C(p,"scroll",()=>d(p,b))}L&&N&&K&&D&&C(L,"click",()=>{const r=!(D.dataset.collapsed==="true");D.dataset.collapsed=String(r),N.classList.toggle("hidden",r),K.classList.toggle("hidden",!r),L.setAttribute("aria-expanded",String(!r));const d=L.querySelector("[data-lucide]");be(d,r?"chevron-down":"chevron-up")}),e&&C(e,"change",o=>{const r=o.target;if(r.matches("[data-filter-category]")){const d=r.dataset.filterCategory;t.filters.categoryFilters[d]=r.value,z(),w(),T()}r.matches("#filter-start-date")&&(t.filters.dateRange.start=document.getElementById("filter-start-date")?.value||"",t.filters.dateRange.end="",z(),w(),T())}),A&&(C(A,"click",o=>{const r=o.target.closest("#unit-type-toggle");if(!r)return;const d=A.querySelector("#unit-type-panel");if(!d)return;const m=d.classList.toggle("hidden");r.setAttribute("aria-expanded",String(!m))}),C(A,"change",o=>{if(!o.target.matches('input[type="checkbox"]'))return;const d=A.querySelector("#unit-type-options"),m=A.querySelector("#unit-type-summary"),E=A.querySelector("#unit-type-label"),k=Array.from(d?.querySelectorAll('input[type="checkbox"]')||[]).filter(M=>M.checked).map(M=>M.value);t.filters.unitTypeSelection=k,m&&(m.textContent=String(k.length)),E&&(E.textContent=k.length===1?k[0]:"Unit Type"),z(),w(),T()})),g&&(C(g,"click",o=>{const r=o.target.closest("#vehicle-status-toggle");if(!r)return;const d=g.querySelector("#vehicle-status-panel");if(!d)return;const m=d.classList.toggle("hidden");r.setAttribute("aria-expanded",String(!m))}),C(g,"change",o=>{if(!o.target.matches('input[type="checkbox"]'))return;const d=g.querySelector("#vehicle-status-options"),m=g.querySelector("#vehicle-status-summary"),E=g.querySelector("#vehicle-status-label"),k=Array.from(d?.querySelectorAll('input[type="checkbox"]')||[]).filter(M=>M.checked).map(M=>M.value);t.filters.vehicleStatusSelection=k,m&&(m.textContent=String(k.length)),E&&(E.textContent=k.length===1?k[0]:"Vehicle Status"),z(),w(),T()})),C(l,"click",()=>{J(),z(),w(),T()}),C(n,"click",()=>{t.table.page=Math.max(1,t.table.page-1),w()}),C(a,"click",()=>{t.table.page+=1,w()}),C(s,"change",()=>{t.table.perPage=Number(s.value),t.table.page=1,w(),T()}),C(i,"change",()=>{const o=t.derived.filtered.length,r=Math.max(1,Math.ceil(o/t.table.perPage)),d=Math.min(Math.max(1,Number(i.value)||1),r);t.table.page=d,w()}),C(ue,"click",o=>{const r=o.target.closest("[data-column-edit]");if(!r)return;const d=r.dataset.columnEdit;if(!d)return;const m=X(d),E=window.prompt("Edit column name",m);E!==null&&(tt(d,E),w(),T())}),C(u,"click",o=>{const r=o.target.closest("[data-sort]");if(!r)return;const d=r.dataset.sort;t.table.sort.key===d?t.table.sort.direction=t.table.sort.direction==="asc"?"desc":"asc":(t.table.sort.key=d,t.table.sort.direction="asc"),w(),T()});const fe=(o=null)=>{u?.querySelectorAll("[data-column-filter-panel]").forEach(r=>{r.dataset.columnFilterPanel!==o&&r.classList.add("hidden")})};C(u,"click",o=>{const r=o.target.closest("[data-column-filter-toggle]");if(!r)return;o.preventDefault(),o.stopPropagation();const d=r.dataset.columnFilterToggle,m=u.querySelector(`[data-column-filter-panel="${d}"]`);if(!m)return;const E=m.classList.toggle("hidden");fe(E?null:d)}),C(u,"dragstart",o=>{if(R)return;const r=o.target.closest("th[data-col-key]");!r||o.target.closest("[data-resize-handle]")||(j=r.dataset.colKey,o.dataTransfer.effectAllowed="move",o.dataTransfer.setData("text/plain",j))}),C(u,"dragover",o=>{!j||!o.target.closest("th[data-col-key]")||o.preventDefault()}),C(u,"drop",o=>{if(!j)return;const r=o.target.closest("th[data-col-key]");if(!r)return;o.preventDefault();const d=r.dataset.colKey;if(d&&d!==j){const m=t.table.columnOrder.slice(),E=m.indexOf(j),k=m.indexOf(d);E!==-1&&k!==-1&&(m.splice(E,1),m.splice(k,0,j),t.table.columnOrder=m,w(),T())}j=null}),C(u,"dragend",()=>{j=null}),C(f,"click",o=>{const r=o.target.closest("[data-row-key]");if(!r)return;const d=t.vehiclesRaw.get(r.dataset.rowKey);d&&Pt(d)}),C(u,"change",o=>{const r=o.target;if(!r.matches("[data-column-filter]"))return;const d=r.dataset.columnFilter,m=t.filters.columnFilters[d]||{select:"all",search:""};if(m.select=r.value,t.filters.columnFilters[d]=m,t.filters.lastLeadKey&&d===t.filters.lastLeadKey){t.filters.lastLeadSelection=r.value==="all"?"all":Q(r.value),t.filters.lastLeadFilterActive=r.value!=="all";const E=document.getElementById("last-deal-select");E&&(E.value=t.filters.lastLeadSelection==="all"?"all":t.filters.lastLeadSelection?"true":"false"),J({preserveSelections:!0})}z(),w(),T()}),C(u,"keydown",o=>{const r=o.target;if(!r.matches("[data-column-search]")||o.key!=="Enter")return;o.preventDefault();const d=r.dataset.columnSearch,m=t.filters.columnFilters[d]||{select:"all",search:""};m.search=r.value.trim().toLowerCase(),t.filters.columnFilters[d]=m,z(),w(),T()});const ge=o=>{if(!R)return;const r=o.clientX-R.startX,d=Math.max(60,R.startWidth+r);R.currentWidth=d,R.col&&(R.col.style.width=`${d}px`)},Ke=()=>{R&&(R.handle?.hasPointerCapture(R.pointerId)&&R.handle.releasePointerCapture(R.pointerId),typeof R.currentWidth=="number"&&(t.table.columnWidths[R.key]=R.currentWidth),R=null,document.body.classList.remove("select-none"),window.removeEventListener("pointermove",ge),T(),w(),ie())};C(u,"pointerdown",o=>{const r=o.target.closest("[data-resize-handle]");if(!r)return;o.preventDefault(),o.stopPropagation();const d=r.dataset.resizeHandle,m=r.closest("th");if(!d||!m)return;const k=document.getElementById("inventory-table-cols")?.querySelector(`col[data-col-key="${d}"]`);k&&(r.setPointerCapture(o.pointerId),R={key:d,startX:o.clientX,startWidth:k.getBoundingClientRect().width,currentWidth:k.getBoundingClientRect().width,handle:r,pointerId:o.pointerId,col:k},document.body.classList.add("select-none"),window.addEventListener("pointermove",ge),window.addEventListener("pointerup",Ke,{once:!0}))}),C(W,"click",Ht),C(q,"click",()=>{if(!V)return;const o=V.classList.toggle("hidden");q.setAttribute("aria-expanded",String(!o))}),document.addEventListener("click",o=>{!V||!q||V.classList.contains("hidden")||V.contains(o.target)||q.contains(o.target)||V.classList.add("hidden")}),document.addEventListener("click",o=>{u&&(u.contains(o.target)||fe())}),C(ue,"change",o=>{const r=o.target;r.matches('input[type="checkbox"]')&&(t.table.columns[r.value]=r.checked,w(),T())}),C(Ne,"click",Ot),document.getElementById("erase-filters")?.addEventListener("click",()=>{J(),t.filters.chartFilters={},z(),w(),T()});const pe=(o=null)=>{We.forEach(r=>{if(r.dataset.chartId===o)return;r.classList.add("hidden"),document.querySelector(`[data-segment-filter-toggle][data-chart-id="${r.dataset.chartId}"]`)?.setAttribute("aria-expanded","false")})};if(Me.forEach(o=>{o.addEventListener("click",r=>{r.stopPropagation();const d=o.dataset.chartId||"default",m=document.querySelector(`[data-segment-filter-panel][data-chart-id="${d}"]`);if(!m)return;const E=m.classList.toggle("hidden");o.setAttribute("aria-expanded",String(!E)),pe(E?null:d)})}),document.addEventListener("click",o=>{o.target.closest("[data-segment-filter-panel]")||o.target.closest("[data-segment-filter-toggle]")||pe()}),document.addEventListener("change",o=>{const r=o.target;if(!r.matches("[data-segment-field-checkbox]"))return;const d=r.dataset.chartId||"default",m=r.dataset.segmentKey||Y,E=de(d,m).slice(),k=r.value;if(r.checked){const M=E.filter(U=>U!==k);Z(d,m,M)}else E.includes(k)||(E.push(k),Z(d,m,E));w(),T()}),document.addEventListener("click",o=>{const r=o.target.closest("[data-segment-select-all]"),d=o.target.closest("[data-segment-clear-all]");if(!r&&!d)return;const m=(r||d).dataset.chartId||"default",k=document.querySelector(`[data-segment-filter-panel][data-chart-id="${m}"]`)?.dataset.segmentKey||Y,M=t.chartVisibilityOptions?.[m]?.[k]||[];r?Z(m,k,[]):d&&Z(m,k,M.slice()),w(),T()}),x&&I&&C(x,"click",()=>{const o=I.classList.toggle("hidden");x.setAttribute("aria-expanded",String(!o))}),c&&h&&C(c,"click",()=>{const o=h.classList.toggle("hidden");c.setAttribute("aria-expanded",String(!o))}),y&&v&&C(y,"click",()=>{const o=v.classList.toggle("hidden");y.setAttribute("aria-expanded",String(!o))}),le.length&&he.length&&ae.length&&me){const o=r=>{const d="220px";ae.forEach(m=>{m.dataset.collapsed=String(r),r?(m.style.height="",m.style.minHeight="0px"):(typeof t.layout.fullChartHeight=="number"&&(m.style.height=`${t.layout.fullChartHeight}px`),m.style.minHeight=d)}),he.forEach(m=>m.classList.toggle("hidden",r)),me.classList.toggle("hidden",r),le.forEach(m=>{m.setAttribute("aria-expanded",String(!r));const E=m.querySelector("[data-lucide]");be(E,r?"chevron-down":"chevron-up")}),t.layout.fullChartCollapsed=r,T()};le.forEach(r=>{C(r,"click",()=>{const d=ae[0]?.dataset.collapsed==="true";o(!d)})})}document.addEventListener("click",o=>{!I||I.classList.contains("hidden")||I.contains(o.target)||x?.contains(o.target)||(I.classList.add("hidden"),x?.setAttribute("aria-expanded","false"))}),document.addEventListener("click",o=>{const r=document.getElementById("unit-type-panel"),d=document.getElementById("unit-type-toggle");!r||r.classList.contains("hidden")||r.contains(o.target)||d?.contains(o.target)||(r.classList.add("hidden"),d?.setAttribute("aria-expanded","false"))}),document.addEventListener("click",o=>{const r=document.getElementById("vehicle-status-panel"),d=document.getElementById("vehicle-status-toggle");!r||r.classList.contains("hidden")||r.contains(o.target)||d?.contains(o.target)||(r.classList.add("hidden"),d?.setAttribute("aria-expanded","false"))}),C(O,"change",o=>{if(!o.target.matches('input[type="checkbox"]'))return;const d=Array.from(O.querySelectorAll('input[type="checkbox"]')).filter(m=>m.checked).map(m=>m.value);t.filters.salesChannels=d,P&&(P.textContent=String(d.length)),$&&($.textContent=d.length===1?d[0]:"Sales Channel"),z(),w(),T()}),C(B,"change",()=>{const{lastLeadKey:o}=t.filters;if(!o)return;const r=B.value,d=r==="all"?"all":r==="true";t.filters.lastLeadSelection=d,t.filters.lastLeadFilterActive=r!=="all",t.filters.columnFilters[o]={select:r,search:""},z(),w(),T(),J({preserveSelections:!0})}),Re.forEach(o=>{o.addEventListener("change",r=>{const d=r.target.dataset.chartId||"default";t.chartSegments[d]=r.target.value||Y,w(),T()})}),De.forEach(o=>{o.addEventListener("click",r=>{const d=r.target.closest("button[data-status][data-segment-key]");if(!d)return;const m=o.dataset.chartId||"default",E=d.dataset.segmentKey,k=d.dataset.status,M=t.filters.chartFilters?.[m];if(!M||M.key!==E)t.filters.chartFilters[m]={key:E,values:[k]};else{const U=Array.isArray(M.values)?M.values.slice():[],ye=U.indexOf(k);ye>=0?U.splice(ye,1):U.push(k),U.length?t.filters.chartFilters[m]={key:E,values:U}:delete t.filters.chartFilters[m]}z(),w(),T()})})},Rt=()=>{const e=document.getElementById("deal-alerts-layout"),l=document.getElementById("panel-resizer"),n=document.getElementById("deal-status-panel"),a=document.getElementById("alerts-panel"),s=document.getElementById("deal-charts-layout"),i=document.getElementById("chart-resizer"),u=document.getElementById("status-primary-card"),f=document.getElementById("status-secondary-card"),b=document.getElementById("panel-height-resizer"),p=document.querySelectorAll("[data-full-chart-card]"),S=document.getElementById("full-chart-height-resizer");if(!e||!l||!n||!a)return;const x=220;let I=0,O=0,P=!1;const $=c=>{if(!P)return;const h=c.clientX-I,g=e.getBoundingClientRect().width,y=l.getBoundingClientRect().width,v=Math.max(x,g-x-y),B=Math.min(v,Math.max(x,O-h));a.style.flex=`0 0 ${B}px`,n.style.flex="1 1 auto"},A=()=>{P&&(P=!1,document.body.classList.remove("select-none","resize-col"),window.removeEventListener("pointermove",$),window.removeEventListener("pointerup",A),t.layout.alertsPanelWidth=a.getBoundingClientRect().width,T())};if(typeof t.layout.alertsPanelWidth=="number"&&window.innerWidth>=1024&&(a.style.flex=`0 0 ${t.layout.alertsPanelWidth}px`,n.style.flex="1 1 auto"),l.addEventListener("pointerdown",c=>{window.innerWidth<1024||(P=!0,I=c.clientX,O=a.getBoundingClientRect().width,document.body.classList.add("select-none","resize-col"),window.addEventListener("pointermove",$),window.addEventListener("pointerup",A))}),s&&i&&u&&f){let h=0,g=0,y=!1;const v=L=>{if(!y)return;const N=L.clientX-h,K=s.getBoundingClientRect().width,D=i.getBoundingClientRect().width,W=Math.max(220,K-220-D),V=Math.min(W,Math.max(220,g+N));u.style.flex=`0 0 ${V}px`,f.style.flex="1 1 auto"},B=()=>{y&&(y=!1,document.body.classList.remove("select-none","resize-col"),window.removeEventListener("pointermove",v),window.removeEventListener("pointerup",B),t.layout.chartSplitWidth=u.getBoundingClientRect().width,T())};typeof t.layout.chartSplitWidth=="number"&&window.innerWidth>=1024&&(u.style.flex=`0 0 ${t.layout.chartSplitWidth}px`,f.style.flex="1 1 auto"),i.addEventListener("pointerdown",L=>{window.innerWidth<1024||(y=!0,h=L.clientX,g=u.getBoundingClientRect().width,document.body.classList.add("select-none","resize-col"),window.addEventListener("pointermove",v),window.addEventListener("pointerup",B))})}if(b){let h=0,g=0,y=!1;const v=L=>{if(!y)return;const N=L.clientY-h,D=`${Math.max(220,g+N)}px`;n.style.height=D,a.style.height=D,u&&(u.style.height=D),f&&(f.style.height=D)},B=()=>{y&&(y=!1,document.body.classList.remove("select-none","resize-row"),window.removeEventListener("pointermove",v),window.removeEventListener("pointerup",B),t.layout.dealPanelHeight=n.getBoundingClientRect().height,T())};if(typeof t.layout.dealPanelHeight=="number"&&window.innerWidth>=1024){const L=`${t.layout.dealPanelHeight}px`;n.style.height=L,a.style.height=L,u&&(u.style.height=L),f&&(f.style.height=L)}b.addEventListener("pointerdown",L=>{window.innerWidth<1024||(y=!0,h=L.clientY,g=n.getBoundingClientRect().height,document.body.classList.add("select-none","resize-row"),window.addEventListener("pointermove",v),window.addEventListener("pointerup",B))})}if(p.length&&S){let h=0,g=0,y=!1;const v=L=>{if(!y)return;const N=L.clientY-h,K=Math.max(220,g+N);p.forEach(D=>{D.style.height=`${K}px`})},B=()=>{y&&(y=!1,document.body.classList.remove("select-none","resize-row"),window.removeEventListener("pointermove",v),window.removeEventListener("pointerup",B),t.layout.fullChartHeight=p[0].getBoundingClientRect().height,T())};typeof t.layout.fullChartHeight=="number"&&p.forEach(L=>{L.style.height=`${t.layout.fullChartHeight}px`}),S.addEventListener("pointerdown",L=>{window.innerWidth<1024||p[0].dataset.collapsed!=="true"&&(y=!0,h=L.clientY,g=p[0].getBoundingClientRect().height,document.body.classList.add("select-none","resize-row"),window.addEventListener("pointermove",v),window.addEventListener("pointerup",B))})}},Dt=()=>{const e=document.getElementById("filter-toggle"),l=document.getElementById("active-filters"),n=document.getElementById("filter-builder"),a=document.getElementById("advanced-toggle"),s=document.getElementById("filter-category-block");if(!e||!l||!n)return;e.classList.add(...se.split(" ")),document.querySelectorAll("[data-pill-control]").forEach(p=>{p!==e&&p.classList.add(...se.split(" "))});const i=window.matchMedia("(min-width: 768px)");let u=!1;const f=p=>{l.classList.toggle("hidden",!p),e.setAttribute("aria-expanded",String(p))};f(i.matches),e.addEventListener("click",()=>{u=!0;const p=e.getAttribute("aria-expanded")==="true";f(!p)});const b=p=>{u||f(p.matches)};if(i.addEventListener?i.addEventListener("change",b):i.addListener(b),a&&s){const p=S=>{s.classList.toggle("hidden",!S),a.setAttribute("aria-expanded",String(S))};p(!1),a.addEventListener("click",()=>{const S=a.getAttribute("aria-expanded")==="true";p(!S)})}},Mt=e=>{const l=e.new||e.old;if(!l)return;t.schema.length||(t.schema=$e([l]),Oe());const n=Fe(l),a=e.commit_timestamp?new Date(e.commit_timestamp).getTime():Date.now();n.lastEventAt=a;const s=ce(n);s&&(e.eventType==="DELETE"?t.vehiclesRaw.delete(s):t.vehiclesRaw.set(s,n),w())},Wt=()=>{if(!F?.channel||t.realtime.channel)return;const e=F.channel("inventory-control-changes").on("postgres_changes",{event:"*",schema:"public",table:"DealsJP1"},Mt);t.realtime.channel=e,e.subscribe(l=>{l==="SUBSCRIBED"?_("Live"):l==="CHANNEL_ERROR"||l==="TIMED_OUT"?_("Reconnecting…"):l==="CLOSED"&&_("Offline")}),window.addEventListener("beforeunload",()=>{t.realtime.channel&&(F.removeChannel(t.realtime.channel),t.realtime.channel=null)})},Kt=async()=>{if(F===null){console.warn("Supabase client not available, skipping vehicle hydration."),t.ui.isLoading=!1,_("Offline"),w();return}if(!F?.from){t.ui.isLoading=!1,_("Offline"),w();return}_("Reconnecting…");const{data:e,error:l}=await F.from("DealsJP1").select("*").limit(5e3);if(l){_("Offline"),t.ui.isLoading=!1,w(),Se("Supabase SELECT failed","Esto suele ser RLS (no tienes SELECT permitido), credenciales, o tabla/columnas distintas.",{code:l.code,message:l.message,details:l.details,hint:l.hint});return}e&&e.length===0&&Se("Query returned 0 records",'The "DealsJP1" table appears empty or RLS policies are hiding all records.',{}),t.schema=$e(e||[]),Et((e||[]).map(n=>{const a=H(n,"Updated At","Updated","Last Updated");return{...n,lastEventAt:a?new Date(a).getTime():null}})),t.ui.isLoading=!1,Oe(),J({preserveSelections:!0}),w(),_("Live")};Dt();J();Nt();Rt();w();const we=document.getElementById("mobile-menu-toggle"),Vt=document.getElementById("primary-nav");we?.addEventListener("click",()=>{const e=Vt.classList.toggle("hidden");we.setAttribute("aria-expanded",String(!e))});(async()=>{if(_("Booting…"),F=await Ye(),await vt(),xt(),!F){_("Offline"),t.ui.isLoading=!1,w();return}await Kt(),Wt()})();

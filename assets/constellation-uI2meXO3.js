(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();const O="modulepreload",U=function(m){return"/TechlocSave/"+m},S={},J=function(t,e,i){let n=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),c=r?.nonce||r?.getAttribute("nonce");n=Promise.allSettled(e.map(l=>{if(l=U(l),l in S)return;S[l]=!0;const g=l.endsWith(".css"),p=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${p}`))return;const d=document.createElement("link");if(d.rel=g?"stylesheet":O,g||(d.as="script"),d.crossOrigin="",d.href=l,c&&d.setAttribute("nonce",c),document.head.appendChild(d),g)return new Promise((h,I)=>{d.addEventListener("load",h),d.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(r){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=r,window.dispatchEvent(c),!c.defaultPrevented)throw r}return n.then(r=>{for(const c of r||[])c.status==="rejected"&&s(c.reason);return t().catch(s)})},V={BASE_URL:"/TechlocSave/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_SUPABASE_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV3Z3RjbHpzY3dib2t4bXp4YmN1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUwODA3MzIsImV4cCI6MjA4MDY1NjczMn0.QkM72rVeBpm6uGgBVdG4ulIzEg3V_7T8usqvIf6vBto",VITE_SUPABASE_URL:"https://ewgtclzscwbokxmzxbcu.supabase.co"};let B="https://ewgtclzscwbokxmzxbcu.supabase.co",C="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV3Z3RjbHpzY3dib2t4bXp4YmN1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUwODA3MzIsImV4cCI6MjA4MDY1NjczMn0.QkM72rVeBpm6uGgBVdG4ulIzEg3V_7T8usqvIf6vBto";try{typeof import.meta<"u"&&V&&(B="https://ewgtclzscwbokxmzxbcu.supabase.co",C="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV3Z3RjbHpzY3dib2t4bXp4YmN1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUwODA3MzIsImV4cCI6MjA4MDY1NjczMn0.QkM72rVeBpm6uGgBVdG4ulIzEg3V_7T8usqvIf6vBto")}catch{}const L=B,x=C;let w;if(typeof window<"u"&&window.supabase&&window.supabase.createClient)w=window.supabase.createClient;else try{const{createClient:m}=await J(async()=>{const{createClient:t}=await import("https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm");return{createClient:t}},[]);w=m}catch{console.error("Failed to load Supabase client module.")}(!L||!x)&&console.error("Supabase URL or Key is missing. Check your .env file.");const j=3e5,P=(m=j)=>typeof fetch!="function"?null:(t,e={})=>fetch(t,e),f=w?w(L||"",x||"",{auth:{persistSession:!0,autoRefreshToken:!0},global:{fetch:P()}}):null;typeof window<"u"&&(window.supabaseClient=f);const T=Object.freeze(Object.defineProperty({__proto__:null,default:f,supabase:f},Symbol.toStringTag,{value:"Module"}));class v{static async getSession(){try{if(!f)return null;const{data:t}=await f.auth.getSession();return t.session}catch(t){return console.error("Error getting session:",t),null}}static async getUserProfile(t){try{if(!f)return null;const{data:e,error:i}=await f.from("profiles").select("role, status").eq("id",t).single();return i||!e?{role:"user",status:"active"}:{role:e.role||"user",status:e.status||"active"}}catch(e){return console.error("Error fetching profile:",e),{role:"user",status:"active"}}}static async logout(){f&&(await f.auth.signOut(),window.location.reload())}static onAuthStateChange(t){if(f)return f.auth.onAuthStateChange(t)}}class N{constructor(){this.navIds={login:"nav-login",logout:"nav-logout",dashboard:"nav-dashboard",services:"nav-services",control:"nav-control-view",inventory:"nav-inventory-control"},this.prefix="./";const t=window.location.pathname;t.includes("/pages/admin/")?this.prefix="../../":t.includes("/pages/")&&(this.prefix="../"),window.addEventListener("header:rendered",()=>{this.init()}),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>this.init()):this.init()}async init(){this.setupListeners(),await this.checkAuth()}setupListeners(){const t=document.getElementById(this.navIds.logout);t&&!t.dataset.listenerAttached&&(t.addEventListener("click",async e=>{e.preventDefault();const i=t.textContent;t.textContent="...";try{await v.logout()}catch(n){console.error("Logout failed:",n),t.textContent=i}}),t.dataset.listenerAttached="true"),this.stateChangeUnsubscribe||(this.stateChangeUnsubscribe=v.onAuthStateChange(async(e,i)=>{this.updateUI(i)}))}async checkAuth(){const t=await v.getSession();await this.updateUI(t)}async updateUI(t){const e=!!t,i=document.getElementById(this.navIds.login),n=document.getElementById(this.navIds.logout),s=document.getElementById(this.navIds.dashboard),r=document.getElementById(this.navIds.services),c=document.getElementById(this.navIds.control);i&&(e?i.classList.add("hidden"):(i.classList.remove("hidden"),i.textContent="Login",i.href=`${this.prefix}pages/login.html`)),n&&(e?(n.classList.remove("hidden"),n.textContent="Logout"):n.classList.add("hidden"));const l=document.getElementById(this.navIds.inventory);[r,l,c].forEach(h=>{h&&h.classList.toggle("hidden",!e)});const p=document.getElementById("hero-login-btn"),d=document.getElementById("hero-dashboard-btn");if(p&&(p.classList.toggle("hidden",e),!e)){const h=p.querySelector("i");p.innerHTML="",h&&p.appendChild(h),p.appendChild(document.createTextNode(" Log in"))}if(d&&d.classList.toggle("hidden",!e),e&&t.user){const h=await v.getUserProfile(t.user.id),I=h.role==="administrator",a=h.status==="suspended";s&&(s.classList.toggle("hidden",!I||a),I&&!a?s.classList.add("md:inline-flex"):s.classList.remove("md:inline-flex"))}else s&&(s.classList.add("hidden"),s.classList.remove("md:inline-flex"));window.dispatchEvent(new CustomEvent("auth:ui-updated",{detail:{isLoggedIn:e,session:t}}))}}new N;const Y=(m="constellation-canvas")=>{const t=document.getElementById(m);if(!t)return{cleanup:()=>{}};const e=t.getContext("2d"),i=[];let n=0,s=0,r,c=!0;const l=()=>{n=window.innerWidth,s=window.innerHeight,t.width=n,t.height=s;const a=Math.min(160,Math.max(80,Math.floor(n*s/22e3)));for(;i.length<a;)i.push({x:Math.random()*n,y:Math.random()*s,vx:(Math.random()-.5)*.35,vy:(Math.random()-.5)*.35,r:Math.random()*2.2+1,alpha:Math.random()*.6+.4,targetAlpha:Math.random()*.7+.4,pulse:Math.random()*Math.PI*2});i.splice(a)},g=a=>{const u=a*9e-4;i.forEach(o=>{o.x+=o.vx*a*.06,o.y+=o.vy*a*.06,o.pulse+=a*.0012,o.x<-20&&(o.x=n+20),o.x>n+20&&(o.x=-20),o.y<-20&&(o.y=s+20),o.y>s+20&&(o.y=-20),Math.random()<.005&&(o.targetAlpha=Math.random()*.7+.4),o.alpha+=(o.targetAlpha-o.alpha)*u*50})},p=()=>{e.clearRect(0,0,n,s);for(let a=0;a<i.length;a+=1){const u=i[a],o=.5+.5*Math.sin(u.pulse);e.beginPath(),e.shadowBlur=10,e.shadowColor="rgba(99, 102, 241, 0.8)",e.fillStyle=`rgba(165, 180, 252, ${u.alpha*o})`,e.arc(u.x,u.y,u.r,0,Math.PI*2),e.fill(),e.shadowBlur=0;for(let b=a+1;b<i.length;b+=1){const y=i[b],z=u.x-y.x,A=u.y-y.y,E=Math.hypot(z,A),M=180;if(E<M){const _=(1-E/M)**2*.5*(.4+.6*Math.sin((u.pulse+y.pulse)*.5));e.strokeStyle=`rgba(125, 211, 252, ${_})`,e.lineWidth=1,e.beginPath(),e.moveTo(u.x,u.y),e.lineTo(y.x,y.y),e.stroke()}}}};let d=performance.now();const h=a=>{if(!c)return;const u=Math.min(40,a-d);d=a,g(u),p(),r=requestAnimationFrame(h)};return l(),window.addEventListener("resize",l),r=requestAnimationFrame(h),{cleanup:()=>{c=!1,r&&cancelAnimationFrame(r),window.removeEventListener("resize",l),e.clearRect(0,0,n,s),i.splice(0,i.length)}}};export{L as S,J as _,x as a,T as b,Y as c,f as s};

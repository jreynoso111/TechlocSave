<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TechLoc System | M&T Service Portal</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
    rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
          animation: {
            'glow': 'glow 8s ease-in-out infinite',
            'bounce-subtle': 'bounce-subtle 2s ease-in-out infinite',
          },
          keyframes: {
            glow: {
              '0%, 100%': { opacity: 0.3, transform: 'scale(1)' },
              '50%': { opacity: 0.6, transform: 'scale(1.2)' },
            },
            'bounce-subtle': {
              '0%, 100%': { transform: 'translateY(0)' },
              '50%': { transform: 'translateY(-5px)' },
            }
          }
        },
      },
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script type="module" src="assets/scripts/authManager.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script type="module" src="assets/scripts/datasets.js"></script>
  <link rel="stylesheet" href="assets/visuals/theme.css" />
  <style>
    .module-card {
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .module-card:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 20px 40px -10px rgba(59, 130, 246, 0.3);
    }

    .hero-gradient {
      background: radial-gradient(circle at top center, rgba(37, 99, 235, 0.15) 0%, transparent 70%);
    }
  </style>
</head>

<body class="min-h-screen bg-slate-950 font-sans text-slate-50 selection:bg-blue-500/30">

  <!-- Background Canvas -->
  <div class="pointer-events-none fixed inset-0 z-0 opacity-40">
    <canvas id="constellation-canvas" class="h-full w-full"></canvas>
  </div>

  <div id="header-root" class="relative z-50"></div>
  <script type="module">
    import { renderHeader } from './assets/components/Header.js';
    renderHeader('header-root');
  </script>

  <main class="relative z-10 ml-auto mr-0 max-w-[1400px] px-6 py-12 md:py-24">

    <!-- Hero Section -->
    <div class="hero-gradient mb-20 text-center">
      <div class="mb-8 flex justify-center">
        <div
          class="group relative flex h-24 w-24 items-center justify-center rounded-3xl bg-slate-900 border border-slate-800 shadow-2xl transition-all duration-500 hover:border-blue-500">
          <div class="absolute inset-0 animate-glow rounded-3xl bg-blue-500 blur-2xl"></div>
          <span class="relative z-10 text-4xl font-black uppercase tracking-[0.2em] text-white">TL</span>
        </div>
      </div>

      <h2
        class="mb-4 flex items-center justify-center gap-2 text-xs font-bold uppercase tracking-[0.3em] text-blue-400">
        <span class="h-px w-8 bg-blue-900"></span>
        Unified Operations Portal
        <span class="h-px w-8 bg-blue-900"></span>
      </h2>

      <h1 class="mb-6 text-5xl font-black tracking-tighter text-white sm:text-7xl">
        TechLoc <span
          class="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-indigo-400 to-blue-600">Network</span>
      </h1>

      <p class="mx-auto mb-10 max-w-2xl text-xl leading-relaxed text-slate-400">
        The mission-critical gateway for nationwide fleet management, coordination, and real-time operational analytics.
      </p>

      <div class="flex flex-wrap items-center justify-center gap-4">
        <a id="hero-login-btn" href="pages/login.html"
          class="inline-flex items-center gap-2 rounded-full bg-blue-600 px-8 py-4 text-sm font-bold text-white shadow-xl shadow-blue-900/40 transition-all hover:bg-blue-50 hover:text-blue-600 hover:-translate-y-1">
          <i data-lucide="log-in" class="h-4 w-4"></i>
          Get Started
        </a>
        <a id="hero-dashboard-btn" href="pages/admin/index.html"
          class="hidden inline-flex items-center gap-2 rounded-full bg-slate-800 border border-slate-700 px-8 py-4 text-sm font-bold text-white transition-all hover:bg-slate-700 hover:border-blue-500 hover:-translate-y-1">
          <i data-lucide="layout-dashboard" class="h-4 w-4"></i>
          Access Dashboard
        </a>
        <a href="#modules"
          class="inline-flex items-center gap-2 rounded-full bg-transparent px-8 py-4 text-sm font-bold text-slate-400 transition-all hover:text-white">
          Explore Modules
          <i data-lucide="arrow-down" class="h-4 w-4 animate-bounce-subtle"></i>
        </a>
      </div>
    </div>


    <!-- Stats Banner -->
    <div class="mt-20 rounded-3xl border border-slate-800 bg-slate-900/30 p-8 backdrop-blur-md">
      <div class="grid grid-cols-2 gap-8 md:grid-cols-4">
        <div class="text-center">
          <p id="tech-count" class="text-3xl font-black text-white">-</p>
          <p class="text-[10px] uppercase font-bold tracking-[0.2em] text-slate-500">Active Partners</p>
        </div>
        <div class="text-center">
          <p id="available-count" class="text-3xl font-black text-emerald-400">-</p>
          <p class="text-[10px] uppercase font-bold tracking-[0.2em] text-slate-500">Live Availability</p>
        </div>
        <div class="text-center">
          <p id="states-count" class="text-3xl font-black text-blue-400">-</p>
          <p class="text-[10px] uppercase font-bold tracking-[0.2em] text-slate-500">States Active</p>
        </div>
        <div class="text-center">
          <p id="avg-rating" class="text-3xl font-black text-amber-300">-</p>
          <p class="text-[10px] uppercase font-bold tracking-[0.2em] text-slate-500">SLA Rating</p>
        </div>
      </div>
    </div>

    <!-- Footer Meta -->
    <div class="mt-16 text-center space-y-4">
      <p class="text-xs text-slate-500 font-medium">
        TechLoc System &copy; 2026. Operated by <a href="mailto:JReynoso111@gmail.com"
          class="text-blue-400 hover:text-blue-300 transition-colors">JReynoso111@gmail.com</a>
      </p>
      <div class="flex items-center justify-center gap-6">
        <span class="h-px w-12 bg-slate-800"></span>
        <p class="text-[10px] uppercase tracking-[0.3em] text-slate-600">M&T Equipment Funding Exclusivity</p>
        <span class="h-px w-12 bg-slate-800"></span>
      </div>
    </div>
  </main>

  <script type="module">
    import { createConstellationBackground } from './assets/scripts/constellation.js';
    import { supabase } from './assets/js/supabaseClient.js';
    import { AuthService } from './assets/scripts/AuthService.js';

    // --- 1. LÓGICA DE ESTADÍSTICAS (SUPABASE) ---
    const animateValue = (id, start, end, duration) => {
      const el = document.getElementById(id);
      if (!el) return;
      const decimalPlaces = Number.isInteger(end) ? 0 : ((end.toString().split('.')[1] || '').length);
      const startTime = performance.now();
      const step = (currentTime) => {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const currentValue = start + (end - start) * progress;
        const formattedValue = decimalPlaces > 0 ? currentValue.toFixed(decimalPlaces) : Math.round(currentValue);
        el.textContent = formattedValue;
        if (progress < 1) requestAnimationFrame(step);
        else el.textContent = Number.isInteger(end) ? end : end.toFixed(decimalPlaces);
      };
      requestAnimationFrame(step);
    };

    const fetchServiceStats = async () => {
      const client = supabase;
      if (!client) return;
      try {
        const { data = [], error, count } = await client
          .from('Services')
          .select('state, status, availability', { count: 'exact' });
        if (error) throw error;
        const totalCount = count ?? data.length ?? 0;
        const availableCount = data.filter(row => {
          const availText = String(row.availability || '').toLowerCase();
          const statusText = String(row.status || '').toLowerCase();
          return availText.includes('24/7') || statusText === 'available' || statusText === 'active';
        }).length;
        const uniqueStates = new Set(data.map(row => row.state ? row.state.trim().toUpperCase() : null).filter(Boolean)).size;
        animateValue('tech-count', 0, totalCount, 2000);
        animateValue('available-count', 0, availableCount, 2000);
        animateValue('states-count', 0, uniqueStates, 2000);
        animateValue('avg-rating', 0, 4.8, 2000);
      } catch (err) { console.warn('Live stats loading failed'); }
    };

    // --- 2. AUTH UI UPDATE ---
    const updateAuthUI = async () => {
      const session = await AuthService.getSession();
      const isLoggedIn = !!session;
      const loginBtn = document.getElementById('hero-login-btn');
      const dashboardBtn = document.getElementById('hero-dashboard-btn');

      if (loginBtn) loginBtn.classList.toggle('hidden', isLoggedIn);
      if (dashboardBtn) dashboardBtn.classList.toggle('hidden', !isLoggedIn);
    };

    // --- 3. INICIALIZACIÓN ---
    document.addEventListener('DOMContentLoaded', () => {
      if (window.lucide) window.lucide.createIcons();
      createConstellationBackground();
      fetchServiceStats();
      updateAuthUI();

      // Listen for auth changes to update hero buttons
      AuthService.onAuthStateChange(() => updateAuthUI());
    });
  </script>
</body>

</html>